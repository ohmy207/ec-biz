typeof module!="undefined"&&typeof exports!="undefined"&&module.exports===exports&&(module.exports="treeControl"),function(e){"use strict";e.module("treeControl",[]).directive("treecontrol",["$compile",function(t){function n(e,t){return e?t?'class="'+e+'"':e:""}function r(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}return{restrict:"EA",require:"treecontrol",transclude:!0,scope:{treeModel:"=",selectedNode:"=?",selectedNodes:"=?",expandedNodes:"=?",onSelection:"&",onNodeToggle:"&",options:"=?",orderBy:"@",reverseOrder:"@",filterExpression:"=?",filterComparator:"=?"},controller:["$scope",function(i){function s(e){return!e[i.options.nodeChildren]||e[i.options.nodeChildren].length===0}function o(t,n){if(e.isArray(t)){n=n||[];for(var r=0;r<t.length;r++)n[r]=t[r]}else if(e.isObject(t)){n=n||{};for(var i in t)hasOwnProperty.call(t,i)&&(i.charAt(0)!=="$"||i.charAt(1)!=="$")&&(n[i]=t[i])}return n||t}function u(t,n){return t===undefined||n===undefined?!1:(t=o(t),t[i.options.nodeChildren]=[],n=o(n),n[i.options.nodeChildren]=[],e.equals(t,n))}function a(){return!0}function l(e){if(!i.options.multiSelection&&i.options.equality(e,i.selectedNode))return!0;if(i.options.multiSelection&&i.selectedNodes){for(var t=0;t<i.selectedNodes.length;t++)if(i.options.equality(e,i.selectedNodes[t]))return!0;return!1}}i.options=i.options||{},r(i.options,"multiSelection",!1),r(i.options,"nodeChildren","children"),r(i.options,"dirSelectable","true"),r(i.options,"injectClasses",{}),r(i.options.injectClasses,"ul",""),r(i.options.injectClasses,"li",""),r(i.options.injectClasses,"liSelected",""),r(i.options.injectClasses,"iExpanded",""),r(i.options.injectClasses,"iCollapsed",""),r(i.options.injectClasses,"iLeaf",""),r(i.options.injectClasses,"label",""),r(i.options.injectClasses,"labelSelected",""),r(i.options,"equality",u),r(i.options,"isLeaf",s),r(i.options,"allowDeselect",!0),r(i.options,"isSelectable",a),i.selectedNodes=i.selectedNodes||[],i.expandedNodes=i.expandedNodes||[],i.expandedNodesMap={};for(var f=0;f<i.expandedNodes.length;f++)i.expandedNodesMap[""+f]=i.expandedNodes[f];i.parentScopeOfTree=i.$parent,i.headClass=function(e){var t=n(i.options.injectClasses.liSelected,!1),r="";return t&&l(e)&&(r=" "+t),i.options.isLeaf(e)?"tree-leaf"+r:i.expandedNodesMap[this.$id]?"tree-expanded"+r:"tree-collapsed"+r},i.iBranchClass=function(){return i.expandedNodesMap[this.$id]?n(i.options.injectClasses.iExpanded):n(i.options.injectClasses.iCollapsed)},i.nodeExpanded=function(){return!!i.expandedNodesMap[this.$id]},i.selectNodeHead=function(){var e=this,t=i.expandedNodesMap[e.$id]===undefined;i.expandedNodesMap[e.$id]=t?e.node:undefined;if(t)i.expandedNodes.push(e.node);else{var n;for(var r=0;r<i.expandedNodes.length&&!n;r++)i.options.equality(i.expandedNodes[r],e.node)&&(n=r);n!==undefined&&i.expandedNodes.splice(n,1)}if(i.onNodeToggle){var s=e.$parent.node===e.synteticRoot?null:e.$parent.node;i.onNodeToggle({node:e.node,$parentNode:s,$index:e.$index,$first:e.$first,$middle:e.$middle,$last:e.$last,$odd:e.$odd,$even:e.$even,expanded:t})}},i.selectNodeLabel=function(e){var t=this;if(!i.options.isLeaf(e)&&(!i.options.dirSelectable||!i.options.isSelectable(e)))this.selectNodeHead();else{if(i.options.isLeaf(e)&&!i.options.isSelectable(e))return;var n=!1;if(i.options.multiSelection){var r=-1;for(var s=0;s<i.selectedNodes.length;s++)if(i.options.equality(e,i.selectedNodes[s])){r=s;break}r===-1?(i.selectedNodes.push(e),n=!0):i.selectedNodes.splice(r,1)}else i.options.equality(e,i.selectedNode)?i.options.allowDeselect?i.selectedNode=undefined:(i.selectedNode=e,n=!0):(i.selectedNode=e,n=!0);if(i.onSelection){var o=t.$parent.node===t.synteticRoot?null:t.$parent.node;i.onSelection({node:e,selected:n,$parentNode:o,$index:t.$index,$first:t.$first,$middle:t.$middle,$last:t.$last,$odd:t.$odd,$even:t.$even})}}},i.selectedClass=function(){var e=l(this.node),t=n(i.options.injectClasses.labelSelected,!1),r="";return t&&e&&(r=" "+t),e?"tree-selected"+r:""},i.unselectableClass=function(){var e=!i.options.isSelectable(this.node),t=n(i.options.injectClasses.labelUnselectable,!1);return e?"tree-unselectable "+t:""};var c=i.orderBy?" | orderBy:orderBy:reverseOrder":"",h="<ul "+n(i.options.injectClasses.ul,!0)+">"+'<li ng-repeat="node in node.'+i.options.nodeChildren+" | filter:filterExpression:filterComparator "+c+'" ng-class="headClass(node)" '+n(i.options.injectClasses.li,!0)+"set-node-to-data>"+'<i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i>'+'<i class="tree-leaf-head '+n(i.options.injectClasses.iLeaf,!1)+'"></i>'+'<div class="tree-label '+n(i.options.injectClasses.label,!1)+'" ng-class="[selectedClass(), unselectableClass()]" ng-click="selectNodeLabel(node)" tree-transclude></div>'+'<treeitem ng-if="nodeExpanded()"></treeitem>'+"</li>"+"</ul>";this.template=t(h)}],compile:function(t,n,r){return function(t,n,i,s){t.$watch("treeModel",function(r){if(e.isArray(r)){if(e.isDefined(t.node)&&e.equals(t.node[t.options.nodeChildren],r))return;t.node={},t.synteticRoot=t.node,t.node[t.options.nodeChildren]=r}else{if(e.equals(t.node,r))return;t.node=r}}),t.$watchCollection("expandedNodes",function(r,i){var s=0,o={},u=n.find("li"),a=[];e.forEach(u,function(t){var n=e.element(t),r={$id:n.data("scope-id"),node:n.data("node")};a.push(r)}),e.forEach(r,function(e){var n=!1;for(var r=0;r<a.length&&!n;r++){var i=a[r];t.options.equality(e,i.node)&&(o[i.$id]=i.node,n=!0)}n||(o[s++]=e)}),t.expandedNodesMap=o}),s.template(t,function(e){n.html("").append(e)}),t.$treeTransclude=r}}}}]).directive("setNodeToData",["$parse",function(e){return{restrict:"A",link:function(e,t,n){t.data("node",e.node),t.data("scope-id",e.$id)}}}]).directive("treeitem",function(){return{restrict:"E",require:"^treecontrol",link:function(e,t,n,r){r.template(e,function(e){t.html("").append(e)})}}}).directive("treeTransclude",function(){return{link:function(t,n,r,i){t.options.isLeaf(t.node)||e.forEach(t.expandedNodesMap,function(e,n){t.options.equality(e,t.node)&&(t.expandedNodesMap[t.$id]=t.node,t.expandedNodesMap[n]=undefined)});if(!t.options.multiSelection&&t.options.equality(t.node,t.selectedNode))t.selectedNode=t.node;else if(t.options.multiSelection){var s=[];for(var o=0;o<t.selectedNodes.length;o++)t.options.equality(t.node,t.selectedNodes[o])&&s.push(t.node);t.selectedNodes=s}t.transcludeScope=t.parentScopeOfTree.$new(),t.transcludeScope.node=t.node,t.transcludeScope.$parentNode=t.$parent.node===t.synteticRoot?null:t.$parent.node,t.transcludeScope.$index=t.$index,t.transcludeScope.$first=t.$first,t.transcludeScope.$middle=t.$middle,t.transcludeScope.$last=t.$last,t.transcludeScope.$odd=t.$odd,t.transcludeScope.$even=t.$even,t.$on("$destroy",function(){t.transcludeScope.$destroy()}),t.$treeTransclude(t.transcludeScope,function(e){n.empty(),n.append(e)})}}})}(angular);